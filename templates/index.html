<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›¾ç‰‡å‹ç¼©å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 28px;
        }
        
        .upload-section {
            margin-bottom: 30px;
        }
        
        .drop-area {
            border: 2px dashed #667eea;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }
        
        .drop-area:hover {
            border-color: #764ba2;
            background-color: #f8f9fa;
        }
        
        .drop-area.dragover {
            border-color: #764ba2;
            background-color: #e8f0fe;
        }
        
        .drop-area p {
            color: #666;
            margin: 10px 0;
        }
        
        #fileInput {
            display: none;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            margin: 5px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .settings-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .settings-section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 20px;
        }
        
        .size-inputs {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .input-group {
            flex: 1;
            min-width: 150px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #666;
            font-weight: 500;
        }
        
        .input-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        .files-section {
            margin-bottom: 30px;
        }
        
        .files-section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 20px;
        }
        
        .file-list {
            list-style: none;
            margin-bottom: 20px;
        }
        
        .file-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .file-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .file-icon {
            font-size: 24px;
        }
        
        .file-name {
            font-weight: 500;
            color: #333;
        }
        
        .file-size {
            font-size: 14px;
            color: #666;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .result-section {
            margin-top: 30px;
        }
        
        .result-section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 20px;
        }
        
        .compressed-item {
            background: #e8f5e8;
            padding: 20px;
            border-radius: 6px;
            margin-bottom: 15px;
            border-left: 4px solid #4caf50;
        }
        
        .compressed-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .compressed-info {
            flex: 1;
        }
        
        .compressed-name {
            font-weight: 500;
            color: #333;
            margin-bottom: 5px;
        }
        
        .size-info {
            display: flex;
            gap: 20px;
            font-size: 14px;
            color: #666;
        }
        
        .preview {
            max-width: 150px;
            max-height: 150px;
            border-radius: 4px;
            object-fit: contain;
            margin-right: 20px;
        }
        
        .download-btn {
            background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
        }
        
        .download-btn:hover {
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }
        
        .status-message {
            padding: 12px;
            border-radius: 4px;
            margin: 10px 0;
            font-weight: 500;
        }
        
        .success {
            background-color: #e8f5e8;
            color: #4caf50;
            border: 1px solid #c8e6c9;
        }
        
        .error {
            background-color: #ffebee;
            color: #f44336;
            border: 1px solid #ffcdd2;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(102, 126, 234, 0.3);
            border-radius: 50%;
            border-top-color: #667eea;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }
            
            .size-inputs {
                flex-direction: column;
            }
            
            .compressed-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .preview {
                margin-right: 0;
                margin-bottom: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Timoçš„å›¾ç‰‡å‹ç¼©å·¥å…·</h1>
        
        <!-- ä¸Šä¼ åŒºåŸŸ -->
        <div class="upload-section">
            <div class="drop-area" id="dropArea">
                <div class="file-icon">ğŸ“</div>
                <h3>æ‹–æ”¾å›¾ç‰‡åˆ°æ­¤å¤„æˆ–ç‚¹å‡»ä¸Šä¼ </h3>
                <p>æ”¯æŒæ ¼å¼ï¼šJPG, JPEG, PNG, HEIF, HEIC, WebP</p>
                <p>æ”¯æŒå¤šå¼ å›¾ç‰‡åŒæ—¶ä¸Šä¼ å’Œå¤„ç†</p>
                <button class="btn" onclick="document.getElementById('fileInput').click()">é€‰æ‹©å›¾ç‰‡</button>
                <input type="file" id="fileInput" multiple accept=".jpg,.jpeg,.png,.heif,.heic,.webp">
            </div>
            
            <div class="files-section" id="filesSection" style="display: none;">
                <h2>å·²é€‰æ‹©çš„å›¾ç‰‡</h2>
                <ul class="file-list" id="fileList"></ul>
                <div style="text-align: center;">
                    <button class="btn" id="compressBtn" onclick="compressFiles()">å¼€å§‹å‹ç¼©</button>
                </div>
            </div>
        </div>
        
        <!-- å‹ç¼©è®¾ç½® -->
        <div class="settings-section">
            <h2>å‹ç¼©è®¾ç½®</h2>
            <div style="margin-bottom: 15px;">
                <input type="checkbox" id="keepAspectRatio" checked>
                <label for="keepAspectRatio" style="margin-left: 8px; color: #666;">ä¿æŒåŸå§‹é•¿å®½æ¯”</label>
            </div>
            <div class="size-inputs">
                <div class="input-group">
                    <label for="maxWidth">æœ€å¤§å®½åº¦ (åƒç´ )</label>
                    <input type="number" id="maxWidth" value="1920" min="100" max="8000">
                </div>
                <div class="input-group">
                    <label for="maxHeight">æœ€å¤§é«˜åº¦ (åƒç´ )</label>
                    <input type="number" id="maxHeight" value="1080" min="100" max="8000">
                </div>
            </div>
        </div>
        
        <!-- è¿›åº¦æ˜¾ç¤º -->
        <div id="progressSection" style="display: none;">
            <h2>å‹ç¼©è¿›åº¦</h2>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <p style="text-align: center; color: #666; margin-top: 10px;">æ­£åœ¨å‹ç¼©ï¼Œè¯·ç¨å€™...</p>
        </div>
        
        <!-- ç»“æœåŒºåŸŸ -->
        <div class="result-section" id="resultSection">
            <!-- æ‰‹åŠ¨æ¸…ç†æŒ‰é’®å°†åœ¨è¿™é‡ŒåŠ¨æ€æ·»åŠ  -->
        </div>
        
        <!-- è‡ªåŠ¨æ¸…ç†æç¤º -->
        <div style="text-align: center; margin-top: 20px; background: rgba(255, 255, 255, 0.95); padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); border: 1px solid #e0e0e0;">
            <p style="margin: 0; color: #333; font-weight: 600; font-size: 16px;">æç¤ºï¼šæ–‡ä»¶å°†åœ¨ç”Ÿæˆå1åˆ†é’Ÿè‡ªåŠ¨æ¸…ç†</p>
        </div>
    </div>
    
    <script>
        let selectedFiles = [];
        let uploadedFiles = [];
        let compressedFiles = [];
        
        // æ–‡ä»¶æ‹–æ”¾å¤„ç†
        const dropArea = document.getElementById('dropArea');
        
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, preventDefaults, false);
        });
        
        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }
        
        ['dragenter', 'dragover'].forEach(eventName => {
            dropArea.addEventListener(eventName, highlight, false);
        });
        
        ['dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, unhighlight, false);
        });
        
        function highlight() {
            dropArea.classList.add('dragover');
        }
        
        function unhighlight() {
            dropArea.classList.remove('dragover');
        }
        
        dropArea.addEventListener('drop', handleDrop, false);
        
        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            handleFiles(files);
        }
        
        // æ–‡ä»¶é€‰æ‹©å¤„ç†
        document.getElementById('fileInput').addEventListener('change', function(e) {
            handleFiles(e.target.files);
        });
        
        function handleFiles(files) {
            selectedFiles = Array.from(files);
            updateFileList();
        }
        
        function updateFileList() {
            const fileList = document.getElementById('fileList');
            const filesSection = document.getElementById('filesSection');
            
            fileList.innerHTML = '';
            
            selectedFiles.forEach(file => {
                const li = document.createElement('li');
                li.className = 'file-item';
                li.innerHTML = `
                    <div class="file-info">
                        <span class="file-name">${file.name}</span>
                        <span class="file-size">(${formatFileSize(file.size)})</span>
                    </div>
                `;
                fileList.appendChild(li);
            });
            
            if (selectedFiles.length > 0) {
                filesSection.style.display = 'block';
            } else {
                filesSection.style.display = 'none';
            }
        }
        
        // å­˜å‚¨åŸå§‹å›¾ç‰‡çš„é•¿å®½æ¯”
        let originalAspectRatio = 16 / 9; // é»˜è®¤16:9
        
        // è·å–å›¾ç‰‡çš„é•¿å®½æ¯”
        function getImageAspectRatio(file) {
            return new Promise((resolve) => {
                // è®¾ç½®é»˜è®¤æ¯”ä¾‹ï¼ˆ16:9ï¼‰ï¼Œé¿å…è·å–å¤±è´¥æ—¶å½±å“æµç¨‹
                const defaultRatio = 16 / 9;
                
                try {
                    const img = new Image();
                    
                    // è®¾ç½®è¶…æ—¶æ—¶é—´ä¸º3ç§’
                    const timeoutId = setTimeout(() => {
                        console.warn('è·å–å›¾ç‰‡å°ºå¯¸è¶…æ—¶ï¼Œä½¿ç”¨é»˜è®¤æ¯”ä¾‹');
                        resolve(defaultRatio);
                        URL.revokeObjectURL(img.src);
                    }, 3000);
                    
                    img.onload = () => {
                        clearTimeout(timeoutId);
                        const ratio = img.width / img.height;
                        // ç¡®ä¿è·å–åˆ°æœ‰æ•ˆçš„é•¿å®½æ¯”
                        if (isNaN(ratio) || ratio <= 0) {
                            resolve(defaultRatio);
                        } else {
                            resolve(ratio);
                        }
                        URL.revokeObjectURL(img.src);
                    };
                    
                    img.onerror = () => {
                        clearTimeout(timeoutId);
                        console.warn('æ— æ³•è·å–å›¾ç‰‡å°ºå¯¸ï¼Œä½¿ç”¨é»˜è®¤æ¯”ä¾‹');
                        resolve(defaultRatio);
                        URL.revokeObjectURL(img.src);
                    };
                    
                    img.src = URL.createObjectURL(file);
                } catch (error) {
                    console.warn('è·å–å›¾ç‰‡å°ºå¯¸å‡ºé”™ï¼Œä½¿ç”¨é»˜è®¤æ¯”ä¾‹:', error.message);
                    resolve(defaultRatio);
                }
            });
        }
        
        // ä¸Šä¼ æ–‡ä»¶
        async function uploadFiles() {
            // è·å–ç¬¬ä¸€å¼ å›¾ç‰‡çš„é•¿å®½æ¯”ï¼ˆç”¨äºä¿æŒæ¯”ä¾‹ï¼‰
            if (selectedFiles.length > 0 && document.getElementById('keepAspectRatio').checked) {
                try {
                    originalAspectRatio = await getImageAspectRatio(selectedFiles[0]);
                    console.log('åŸå§‹é•¿å®½æ¯”:', originalAspectRatio);
                } catch (error) {
                    console.error('è·å–å›¾ç‰‡é•¿å®½æ¯”å¤±è´¥:', error);
                }
            }
            
            const formData = new FormData();
            selectedFiles.forEach(file => {
                formData.append('files', file);
            });
            
            // ä½¿ç”¨XMLHttpRequestä»£æ›¿fetchï¼Œæä¾›æ›´å¥½çš„å¤§æ–‡ä»¶ä¸Šä¼ æ”¯æŒå’Œè¿›åº¦æ˜¾ç¤º
            return new Promise((resolve, reject) => {
                const xhr = new XMLHttpRequest();
                
                // è®¾ç½®è¶…æ—¶æ—¶é—´ï¼ˆ5åˆ†é’Ÿï¼‰
                xhr.timeout = 300000;
                
                // ä¸Šä¼ è¿›åº¦äº‹ä»¶
                xhr.upload.onprogress = function(e) {
                    if (e.lengthComputable) {
                        const progress = Math.round((e.loaded / e.total) * 100);
                        console.log(`ä¸Šä¼ è¿›åº¦: ${progress}%`);
                        
                        // æ›´æ–°è¿›åº¦æ¡
                        const progressFill = document.getElementById('progressFill');
                        if (progressFill) {
                            progressFill.style.width = `${progress}%`;
                        }
                    }
                };
                
                // è¯·æ±‚å®Œæˆäº‹ä»¶
                xhr.onload = function() {
                    if (xhr.status === 200) {
                        try {
                            const data = JSON.parse(xhr.responseText);
                            uploadedFiles = data.files;
                            resolve(uploadedFiles);
                        } catch (error) {
                            reject(new Error('è§£æå“åº”å¤±è´¥'));
                        }
                    } else {
                        reject(new Error(`ä¸Šä¼ å¤±è´¥: ${xhr.statusText}`));
                    }
                };
                
                // è¯·æ±‚é”™è¯¯äº‹ä»¶
                xhr.onerror = function() {
                    reject(new Error('ç½‘ç»œé”™è¯¯ï¼Œä¸Šä¼ å¤±è´¥'));
                };
                
                // è¯·æ±‚è¶…æ—¶äº‹ä»¶
                xhr.ontimeout = function() {
                    reject(new Error('ä¸Šä¼ è¶…æ—¶ï¼Œè¯·é‡è¯•'));
                };
                
                // å‘é€è¯·æ±‚
                xhr.open('POST', '/photo/upload');
                xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
                xhr.send(formData);
            });
        }
        
        // åˆå§‹åŒ–é•¿å®½æ¯”ä¿æŒåŠŸèƒ½
        function initAspectRatio() {
            const maxWidthInput = document.getElementById('maxWidth');
            const maxHeightInput = document.getElementById('maxHeight');
            const keepAspectCheckbox = document.getElementById('keepAspectRatio');
            
            // ç›‘å¬å®½åº¦å˜åŒ–
            maxWidthInput.addEventListener('input', function() {
                if (keepAspectCheckbox.checked) {
                    const width = parseInt(this.value);
                    if (!isNaN(width) && width > 0) {
                        const height = Math.round(width / originalAspectRatio);
                        maxHeightInput.value = height;
                    }
                }
            });
            
            // ç›‘å¬é«˜åº¦å˜åŒ–
            maxHeightInput.addEventListener('input', function() {
                if (keepAspectCheckbox.checked) {
                    const height = parseInt(this.value);
                    if (!isNaN(height) && height > 0) {
                        const width = Math.round(height * originalAspectRatio);
                        maxWidthInput.value = width;
                    }
                }
            });
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initAspectRatio();
        });
        
        // å‹ç¼©æ–‡ä»¶
        async function compressFiles() {
            try {
                // æ˜¾ç¤ºè¿›åº¦
                const progressSection = document.getElementById('progressSection');
                const compressBtn = document.getElementById('compressBtn');
                const progressFill = document.getElementById('progressFill');
                
                progressSection.style.display = 'block';
                compressBtn.disabled = true;
                progressFill.style.width = '0%';
                
                // ä¸Šä¼ æ–‡ä»¶
                await uploadFiles();
                
                // æ˜¾ç¤ºä¸Šä¼ å®Œæˆï¼Œå¼€å§‹å‹ç¼©
                progressFill.style.width = '30%';
                
                // è·å–å‹ç¼©è®¾ç½®
                const maxWidth = document.getElementById('maxWidth').value;
                const maxHeight = document.getElementById('maxHeight').value;
                
                // å‘é€å‹ç¼©è¯·æ±‚
            const response = await fetch('/photo/compress', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    files: uploadedFiles,
                    max_width: maxWidth,
                    max_height: maxHeight
                })
            });
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.error || 'å‹ç¼©è¯·æ±‚å¤±è´¥');
                }
                
                const data = await response.json();
                if (!data.compressed_files || data.compressed_files.length === 0) {
                    throw new Error('æœªè·å–åˆ°å‹ç¼©åçš„æ–‡ä»¶');
                }
                
                compressedFiles = data.compressed_files;
                
                // æ›´æ–°è¿›åº¦ä¸º100%
                progressFill.style.width = '100%';
                
                // æ˜¾ç¤ºç»“æœ
                displayResults();
                showMessage('å‹ç¼©æˆåŠŸï¼', 'success');
                
            } catch (error) {
                showMessage('å‹ç¼©å¤±è´¥ï¼š' + error.message, 'error');
                // éšè—è¿›åº¦æ¡
                document.getElementById('progressSection').style.display = 'none';
                // æ¸…é™¤å·²ä¸Šä¼ çš„æ–‡ä»¶åˆ—è¡¨
                uploadedFiles = [];
            } finally {
                document.getElementById('compressBtn').disabled = false;
            }
        }
        
        // æ˜¾ç¤ºç»“æœ
        function displayResults() {
            const resultSection = document.getElementById('resultSection');
            resultSection.innerHTML = '<h2>å‹ç¼©ç»“æœ</h2>';
            
            compressedFiles.forEach(file => {
                const compressedItem = document.createElement('div');
                compressedItem.className = 'compressed-item';
                
                // è®¡ç®—å‹ç¼©ç‡
                const compressionRatio = ((1 - file.compressed_size / file.original_size) * 100).toFixed(1);
                
                // æ„å»ºå®Œæ•´ä¸‹è½½é“¾æ¥
                const downloadUrl = `${window.location.origin}/photo/download/${encodeURIComponent(file.compressed_filename)}`;
                
                compressedItem.innerHTML = `
                    <div class="compressed-header" style="flex-direction: column; align-items: flex-start;">
                        <div class="compressed-info" style="width: 100%;">
                            <div class="compressed-name">${file.compressed_filename}</div>
                            <div class="size-info">
                                <span>åŸå§‹å¤§å°: ${formatFileSize(file.original_size)}</span>
                                <span>å‹ç¼©å: ${formatFileSize(file.compressed_size)}</span>
                                <span>å‹ç¼©ç‡: ${compressionRatio}%</span>
                            </div>
                            <div style="margin-top: 15px; display: flex; gap: 10px; width: 100%;">
                                <input type="text" value="${downloadUrl}" readonly style="flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                                <button class="btn" style="background: #4caf50;" onclick="copyToClipboard('${downloadUrl}')">å¤åˆ¶é“¾æ¥</button>
                                <button class="btn download-btn" onclick="downloadFile('${file.compressed_filename}', this)">ä¸‹è½½</button>
                            </div>
                        </div>
                    </div>
                `;
                
                resultSection.appendChild(compressedItem);
            });
            
            // æ·»åŠ å¤åˆ¶æ‰€æœ‰é“¾æ¥æŒ‰é’®
            if (compressedFiles.length > 1) {
                const copyAllDiv = document.createElement('div');
                copyAllDiv.style.cssText = 'text-align: center; margin-top: 20px;';
                copyAllDiv.innerHTML = `
                    <button class="btn" style="background: #2196f3; padding: 15px 30px; font-size: 16px; font-weight: bold;" onclick="copyAllLinks()">å¤åˆ¶æ‰€æœ‰ä¸‹è½½é“¾æ¥</button>
                `;
                resultSection.appendChild(copyAllDiv);
            }
            
            // éšè—è¿›åº¦
            document.getElementById('progressSection').style.display = 'none';
        }
        
        // å¤åˆ¶åˆ°å‰ªè´´æ¿
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showMessage('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
            }).catch(err => {
                showMessage('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶', 'error');
            });
        }
        
        // å¤åˆ¶æ‰€æœ‰é“¾æ¥
        function copyAllLinks() {
            const links = compressedFiles.map(file => {
                return `${window.location.origin}/photo/download/${encodeURIComponent(file.compressed_filename)}`;
            }).join('\n');
            
            navigator.clipboard.writeText(links).then(() => {
                showMessage(`å·²å¤åˆ¶ ${links.split('\n').length} ä¸ªä¸‹è½½é“¾æ¥`, 'success');
            }).catch(err => {
                showMessage('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶', 'error');
            });
        }
        
        // ä¸‹è½½æ–‡ä»¶
        function downloadFile(filename, btn) {
            // ç¦ç”¨æŒ‰é’®å¹¶æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            btn.innerHTML = '<div class="loading"></div> ä¸‹è½½ä¸­...';
            btn.disabled = true;
            
            // åˆ›å»ºä¸‹è½½é“¾æ¥
            const a = document.createElement('a');
            a.href = `/photo/download/${encodeURIComponent(filename)}`;
            a.download = filename;
            document.body.appendChild(a);
            
            a.click();
            document.body.removeChild(a);
            
            // ä¸‹è½½åæ›´æ–°æŒ‰é’®çŠ¶æ€
            setTimeout(() => {
                btn.innerHTML = 'å·²ä¸‹è½½';
            }, 1000);
        }
        

        

        
        // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `status-message ${type}`;
            messageDiv.textContent = message;
            
            const container = document.querySelector('.container');
            container.insertBefore(messageDiv, container.firstChild);
            
            // 3ç§’åè‡ªåŠ¨ç§»é™¤
            setTimeout(() => {
                messageDiv.remove();
            }, 3000);
        }
    </script>
    <!-- é¡µè„š -->
    <footer style="text-align: center; margin-top: 30px; padding: 20px; color: #666; font-size: 14px;">
        <p style="color: #667eea; font-weight: bold;">Author: Timo & TRAE</p>
        <p><a href="https://github.com/timoseven/photo-convert" target="_blank" style="color: #667eea; text-decoration: none;">GitHub: https://github.com/timoseven/photo-convert</a></p>
    </footer>
</body>
</html>